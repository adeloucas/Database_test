<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dataset Viewer</title>
  <link href="https://unpkg.com/tabulator-tables@5.5.0/dist/css/tabulator.min.css" rel="stylesheet">
  
  <style>
    /* GLOBAL RESET */
    * { box-sizing: border-box; }
    
    /* BODY */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    
    h2 { margin: 0 0 20px 0; }
    
    /* DESKTOP LAYOUT: 2 columns - table left, details right */
    .container {
      display: grid;
      grid-template-columns: 1fr 400px;
      grid-template-rows: auto 1fr;
      gap: 20px;
      height: calc(100vh - 100px);
    }
    
    /* Search bar: top-left, first row first column */
    #search-container {
      grid-column: 1;
      grid-row: 1;
      display: flex;
      gap: 10px;
    }
    
    #search-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    #clear-search {
      padding: 10px 20px;
      cursor: pointer;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      white-space: nowrap;
    }
    
    #clear-search:hover { background: #e0e0e0; }
    
    /* Table container: bottom-left, second row first column */
    #table-container {
      grid-column: 1;
      grid-row: 2;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
    }
    
    /* Table fills the flex container */
    #table {
      flex: 1;
      width: 100%;
      height: 100%;
    }
    
    /* Detail panel: right side, spans both rows, second column */
    #detail-panel {
      grid-column: 2;
      grid-row: 1 / 3;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fafafa;
      padding: 20px;
      overflow-y: auto;
    }
    
    #detail-panel h3 { margin: 0 0 15px 0; }
    
    .detail-section {
      padding: 15px;
      margin-bottom: 12px;
      border-radius: 6px;
      background: #fff;
      border: 1px solid #e6e6e6;
    }
    
    .detail-title {
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .detail-row { margin-bottom: 8px; }
    .detail-row:last-child { margin-bottom: 0; }
    
    .detail-label {
      font-weight: 600;
      color: #555;
      min-width: 100px;
      display: inline-block;
    }
    
    a.external-link {
      color: #0b66c3;
      text-decoration: none;
    }
    a.external-link:hover { text-decoration: underline; }
    
    .empty-state {
      color: #999;
      font-style: italic;
      padding: 20px;
      text-align: center;
    }
    
    /* TABLET: Stack vertically when screen < 1024px */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto 1fr;
        height: auto;
        min-height: calc(100vh - 100px);
      }
      
      #search-container {
        grid-column: 1;
        grid-row: 1;
      }
      
      #detail-panel {
        grid-column: 1;
        grid-row: 2;
        max-height: 400px;
      }
      
      #table-container {
        grid-column: 1;
        grid-row: 3;
        min-height: 500px;
      }
    }
    
    /* MOBILE: Further adjustments < 768px */
    @media (max-width: 768px) {
      body { padding: 10px; }
      
      #search-container { 
        flex-direction: column;
        align-items: stretch;
      }
      
      #clear-search { width: 100%; }
      
      .detail-label {
        min-width: 80px;
        font-size: 13px;
      }
    }
  </style>
</head>

<body>
  <h2>Dataset</h2>
  
  <div class="container">
    <div id="search-container">
      <input id="search-input" type="text" placeholder="Search across all fieldsâ€¦">
      <button id="clear-search">Clear</button>
    </div>
    
    <div id="table-container">
      <div id="table"></div>
    </div>
    
    <div id="detail-panel">
      <h3>Record Details</h3>
      <div id="detail-card">
        <div class="empty-state">Click a row to view details</div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://unpkg.com/tabulator-tables@5.5.0/dist/js/tabulator.min.js"></script>

  <script>
    const csvUrl = "https://raw.githubusercontent.com/adeloucas/Database_test/main/test_data.csv";
    
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }
    
    function renderField(label, value) {
      if (!value || value === "-" || value === "0") return "";
      return `<div class="detail-row"><span class="detail-label">${label}:</span> ${escapeHtml(value)}</div>`;
    }
    
    function renderLink(label, url, text) {
      if (!url || url === "-") return "";
      const displayText = text || url;
      return `<div class="detail-row"><span class="detail-label">${label}:</span> <a class="external-link" href="${escapeHtml(url)}" target="_blank">${escapeHtml(displayText)}</a></div>`;
    }
    
    function displayRecord(record) {
      let html = "";
      
      // Section 1: Record Details - TextID fields
      const recordFields = renderField("Deloucas ID", record.TextID_D) + 
                          renderField("ARCHIBAB", record.TNum) + 
                          renderField("CDLI", record.Pnum) +
                          renderField("CDLI ID", record.TextID_C) + 
                          renderField("Archibab ID", record.TextNum_A) + 
                          renderField("TextID_A", record.TextID_A);
      if (recordFields) {
        html += `<div class="detail-section"><div class="detail-title">Record Details</div>${recordFields}`;
        // Add URLs as links
        html += renderLink("ARCHIBAB Link", record.URL_A, "Link to ARCHIBAB");
        html += renderLink("CDLI Link", record.URL_C, "Link to CDLI");
        html += `</div>`;
      }
      
      // Section 2: Date Information
      const dateFields = renderField("Day", record.Day) + 
                        renderField("Month", record.Month) + 
                        renderField("Ruler", record.Ruler) + 
                        renderField("Year", record.Year) + 
                        renderField("Date_D", record.Date_D);
      if (dateFields) {
        html += `<div class="detail-section"><div class="detail-title">Date</div>${dateFields}</div>`;
      }
      
      
      // Section 4: Archive, Genre, Dossier
      const classFields = renderField("Archive", record.Archive_D) + 
                         renderField("Genre", record.Genre_D) + 
                         renderField("Dossier", record.Dossier_D);
      if (classFields) {
        html += `<div class="detail-section"><div class="detail-title">Text Info</div>${classFields}</div>`;
      }
      
      document.getElementById("detail-card").innerHTML = html || "<div class='empty-state'>No details available</div>";
    }
    
    fetch(csvUrl)
      .then(r => r.text())
      .then(text => {
        const parsed = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
          transformHeader: h => h.trim()
        });
        
        const columns = parsed.meta.fields.map(h => ({
          title: h,
          field: h,
          width: 150
        }));
        
        const table = new Tabulator("#table", {
          data: parsed.data,
          layout: "fitDataFill",
          height: "100%",
          columns: columns
        });
        
        table.on("rowClick", (e, row) => displayRecord(row.getData()));
        
        document.getElementById("search-input").addEventListener("input", function() {
          const query = this.value.trim().toLowerCase();
          query ? table.setFilter(data => Object.values(data).some(v => String(v).toLowerCase().includes(query)))
                : table.clearFilter();
        });
        
        document.getElementById("clear-search").addEventListener("click", () => {
          document.getElementById("search-input").value = "";
          table.clearFilter();
        });
      })
      .catch(err => {
        document.getElementById("detail-card").innerHTML = `<div class='empty-state'>Error: ${err.message}</div>`;
        console.error(err);
      });
  </script>
</body>
</html>


